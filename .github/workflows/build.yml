name: Build

on: push

jobs:
#  linux:
#    runs-on: ${{ matrix.os }}
#
#    strategy:
#      matrix:
#        include:
#        - os: ubuntu-18.04
#          cuda: "10.2"
#        - os: ubuntu-16.04
#          cuda: "9.2"
#
#    steps:
#    - uses: actions/checkout@v2
#
#    - name: Install CUDA
#      env:
#        CUDA: ${{ matrix.cuda }}
#      run: .github/tools/linux-install-cuda.sh
#
#    - name: Install Vulkan
#      run: .github/tools/linux-install-vulkan.sh
#
#    - run: cmake .
#
#    - run: make
#
#    - uses: actions/upload-artifact@v2
#      with:
#        name: libgpu-setup-cuda-${{ matrix.cuda }}-${{ matrix.os }}.so
#        path: src/libgpu-setup.so

  windows:
    runs-on: windows-2016

    env:
      VULKAN_SDK: c:/VulkanSDK/1.1.126.0

    steps:
    - uses: actions/checkout@v2

    - name: Install CUDA
      run: choco install cuda --version=10.2.89 --checksum b538271c4d9ffce1a8520bf992d9bd23854f0f29cee67f48c6139e4cf301e253

    - name: Install Vulkan
      run: choco install vulkan-sdk --version=1.1.126.0

    - name: Build
      run: |
        call "c:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\VC\Auxiliary\Build\vcvars64.bat"
        mkdir build
        cd build
        "c:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\Common7\IDE\CommonExtensions\Microsoft\CMake\CMake\bin\cmake" -G "Ninja" -DCMAKE_IGNORE_PATH="C:/Strawberry/c/bin;C:/ProgramData/chocolatey/bin" -DCUDA_TOOLKIT_ROOT_DIR="C:/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v10.2" -DCMAKE_MAKE_PROGRAM="c:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\Common7\IDE\CommonExtensions\Microsoft\CMake\Ninja\ninja.exe" ..
        cmake --build .
      shell: cmd
